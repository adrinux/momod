---
# 'Wireguard' role installs the Wireguard tools package and pre-generates server side keys.
# This role puts configuration into place and starts Wireguard on the server

- name: Register server Wireguard private key
  ansible.builtin.slurp:
    src: /etc/wireguard/privatekey
  register: server_wg_private_key
  become: yes

- name: Register the client Wireguard public key
  ansible.builtin.slurp:
    src: ../../local/files/wireguard/client-publickey
  delegate_to: localhost
  register: client_wg_public_key
  become: no

- name: Deploy Wireguard config for momod0 network to server
  ansible.builtin.template:
    src: momod0.conf.j2
    dest: /etc/wireguard/momod0.conf
    owner: root
    group: root
    mode: 0600
  become: yes

- name: Enable & start server Wireguard service
  ansible.builtin.systemd:
    name: wg-quick@momod0
    state: started
    enabled: yes
