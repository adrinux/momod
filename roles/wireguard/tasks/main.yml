---
# 'Wireguard' package (contains tools) is installed in the
# common-packages role

- name: Generate Wireguard private key
  ansible.builtin.shell: umask 077; wg genkey > /etc/wireguard/privatekey
  args:
    creates: /etc/wireguard/privatekey
  become: yes

- name: Generate Wireguard public key
  ansible.builtin.shell: umask 077; wg pubkey < /etc/wireguard/privatekey > /etc/wireguard/publickey
  args:
    creates: /etc/wireguard/publickey
  become: yes

- name: Backup the private key to your momod/local/fetched directory
  ansible.builtin.fetch:
    src: /etc/wireguard/privatekey
    dest: ../../local/fetched

- name: Backup the public key to your momod/local/fetched directory
  ansible.builtin.fetch:
    src: /etc/wireguard/publickey
    dest: ../../local/fetched
#
# Create config file and upload
# Our local public key is needed?
# Document manually copying to the momod/local folder
# Have task check it exists
